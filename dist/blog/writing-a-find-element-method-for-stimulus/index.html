<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            rel="icon"
            href="/favicon.ico"
            sizes="48x48"
            type="image/x-icon"
        />
        <link
            rel="icon"
            href="/favicon-16x16.webp"
            sizes="16x16"
            type="image/x-icon"
        />
        <link
            rel="icon"
            href="/favicon-32x32.webp"
            sizes="32x32"
            type="image/png"
        />
        <link rel="apple-touch-icon" href="/apple-touch-icon.webp" />
        <link rel="icon" sizes="192x192" href="/android-chrome-192x19.webp" />
        <link rel="icon" sizes="512x512" href="/android-chrome-512x512.webp" />
        <script
            src="https://kit.fontawesome.com/6b5e91c70a.js"
            crossorigin="anonymous"
        ></script>
        <title>DAZ Codes || Writing a Find Element Method for Stimulus</title>
    <script type="module">import * as Turbo from 'https://esm.sh/@hotwired/turbo';</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/monokai-sublime.min.css">
<link rel="stylesheet" href="/css/1-simple.css" />
<link rel="stylesheet" href="/css/2-custom.css" />
</head>
    <body>
        <header class="sticky dropshadow">
            <h1 class="logo text-center">
                <a href="/" title="home"
                    ><span class="daz">DAZ</span
                    ><span class="codes mono-font">&lt;/codes&gt;</span></a
                >
            </h1>
        </header>
        <main class="container"><div><a class="swifty_breadcrumb" href="/">Home</a> &raquo; <a class="swifty_breadcrumb" href="/blog">Blog</a> &raquo; <a class="swifty_breadcrumb" href="/blog/writing-a-find-element-method-for-stimulus">Writing A Find Element Method For Stimulus</a></div>
<h1 class="title brand-font gradient-text">Writing a Find Element Method for Stimulus</h1>

<div class="bold italic primary-text no-margin-y">
    Written by <span class="secondary-text">DAZ</span> on Fri, 8 Aug 2025
</div>

<div class="tags"><a class="tag" href="/tags/stimulus">stimulus</a><a class="tag" href="/tags/javascript">javascript</a><a class="tag" href="/tags/rails">rails</a><a class="tag" href="/tags/hotwire">hotwire</a></div>

<p>While working on a <a href="https://github.com/MerseyRails/merseyrails-kata-1">kata</a> for the recent <a href="https://merseyrails.com">Mersey Rails</a> meet up, me and a colleague were a bit unhappy with how our solutions looked because they had Stimulus controllers that used <code>document.getElementById</code> and <code>this.element.querySelector</code>, both of which didn&#39;t feel very &#39;stimulus-like&#39;. It was made worse by the fact that using the classes API only returns the name of the class rather than the selector needed, leading to code like this:</p>
<pre><code class="language-javascript">const el = this.querySelector(`.${this.activeClass}`)
</code></pre>
<p>Having to use a template literal to preprend the &#39;.&#39; to the start also felt cumbersome.</p>
<p>We both agreed that it would be much nicer if the Stimulus API provided a method that would find elements based on the class names ... something like this:</p>
<pre><code class="language-javascript">const el = this.find(this.activeClass)
</code></pre>
<p>It would be aware that <code>this.activeClass</code> was a class and prepend the &#39;.&#39; for you.</p>
<p>I did a bit of digging and found that the <code>Scope</code> class in Stimulus already has two methods called <code>findElement</code> and <code>findAllElements</code> ... these basically provide a wrapper around <code>this.element.querySelector</code> and <code>this.element.querySelectorAll</code> so ensure they are scoped to the element, but they are only accessible from a controller using <code>this.scope.findElement</code> and <code>this.findAllElements</code>.</p>
<p>So I decided to patch these methods into the <code>Controller</code> class as well as automatically prepending a &#39;.&#39; in front of any classes provided using the class API. While I was at it, I added the ability to search for an ID if one exists. This means that you can do the following, given the this HTML:</p>
<pre><code class="language-html">&lt;div data-controller=&quot;my-controller&quot;
      data-my-controller-active-class=&quot;active&quot;
      data-my-controller-loading-classes=&quot;busy loading&quot;
    &gt;
      &lt;div id=&quot;inside&quot;&gt;This is inside&lt;/div&gt;
      &lt;div class=&quot;busy loading&quot;&gt;This is loading&lt;/div&gt;
      &lt;div class=&quot;active&quot;&gt;&lt;p class=&quot;intro&quot;&gt;This is the intro&lt;/p&gt;&lt;/div&gt;
    &lt;/div&gt;
    &lt;div id=&quot;outside&quot; class=&quot;busy&quot;&gt;This is outside&lt;/div&gt;
</code></pre>
<p>You can find Elements scoped inside the root element by passing the id:</p>
<pre><code class="language-javascript">this.findElement(&quot;inside&quot;)
</code></pre>
<p> This will return  <code>&lt;div id=&quot;inside&quot; class=&quot;busy loading&quot;&gt;...&lt;/div&gt;</code></p>
<pre><code class="language-javascript">this.findElement(&quot;outside&quot;)
</code></pre>
<p>This will return  <code>undefined</code> since it doesn&#39;t match any element inside the controller</p>
<p>You can find elements using defined classes:</p>
<pre><code>this.getElement(this.activeClass)
</code></pre>
<p>This will return  <code>&lt;div class=&quot;active&quot;&gt;...&lt;/div&gt;</code></p>
<pre><code class="language-javascript">this.getElement(this.loadingClasses)
</code></pre>
<p>This will return <code>&lt;div class=&quot;busy loading&quot;&gt;...&lt;/div&gt;</code></p>
<p>You can also find elements using a standard query selector:</p>
<pre><code class="language-javascript">this.getElement(.active p.intro)
</code></pre>
<p>This will return <code>&lt;p class=&quot;intro&quot;&gt;...&lt;/p&gt;</code></p>
<p>The method looks for items with an id first, then looks to see if any classes have been defined on the controller and last of all falls back to using <code>this.element.querySelector</code></p>
<p><code>this.findAllElements</code> works in the same way, but returns an array of all matching elements. It does <strong>not</strong> look for elements with an id as there should only be one element with an id.</p>
<p>The key addition was this private method that checks to see if the string passed is stored in <code>this.classes</code> and if it is will prepend the &#39;.&#39; automatically:</p>
<pre><code class="language-javascript">private classifySelector(selector: string | string[]): string {
    const tokens = Array.isArray(selector) ? selector : [selector]

    const definedClasses: string[] = (this.constructor as any).classes.flatMap((key: string) =&gt; {
      const value = (this as any)[`${key}Classes`] as string[] | undefined
      return value ?? []
    })

    const allTokensDefined = tokens.every((token) =&gt; definedClasses.includes(token))
    return &quot;.&quot; + tokens.join(allTokensDefined ? &quot;.&quot; : &quot; &quot;)
  }
</code></pre>
<p>I submitted a <a href="https://github.com/hotwired/stimulus/pull/854">PR to add this Stimulus</a> ... hopefully it will get accepted!</p>

</main>
        <footer>
            <p>
                This site was built with Swifty, the super speedy static site
                generator.
            </p>
            <p>&copy; DAZ 2025. Made with ðŸ’œ by DAZ.</p>
        </footer>
    </body>
</html>
